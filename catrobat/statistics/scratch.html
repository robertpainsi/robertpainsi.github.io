<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>#code squirrel - Scratch Statistics</title>

    <link rel="stylesheet" href="styles/block-usage.css">

    <script src="/templates/webcomponents-lite.min.js"></script>
    <link rel="import" href="/templates/pages/flatt-page/page.html">

    <script src="scripts/block-usage.js"></script>
</head>
<body>

<flatt-page>
    <h2 class="page-title">Scratch statistics</h2>
    <p>Note that Scratch only uses random samples for its statistics. You can find the Brick usage statistics for
        Catrobat <a href="/catrobat/statistics/#Brick-usage">here</a>.</p>

    <div class="loading center"></div>
    <table id="brick-usage-chart" class="usage-chart table-striped"></table>
</flatt-page>

<script>
    document.addEventListener('WebComponentsReady', function() {
        $.ajax({
            url: "https://scratch.mit.edu/statistics/data/monthly/",
            jsonp: "callback",
            dataType: "json",
            data: {
                format: "json"
            },
            success: function(response) {
                var categories = response.block_distribution.children.filter(function(category) {
                    return category.children.length;
                });

                var blocks = [];
                var total = 0;
                categories.forEach(function(category) {
                    category.children.forEach(function(block) {
                        block.category = category;
                        block.name = block.name
                            .replace(/%[^\s]+/g, 'X')
                            .replace('@turnRight', '↻')
                            .replace('@turnLeft', '↺')
                            .replace('@greenFlag', '⚑')
                        ;
                        total += block.count;
                    });
                    blocks = blocks.concat(category.children);
                });

                blocks.sort(function(a, b) {
                    return b.count - a.count;
                });

                htmlUtils.removeClassFromElements('loading');
                createBlockUsageChart(document.getElementById('brick-usage-chart'), blocks);
            }
        });
    });
</script>

</body>
</html>
