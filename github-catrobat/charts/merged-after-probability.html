<div class="page"></div>
<script>
    menu.registerMenu('Pull Request Merged After', '#link-chart-merged-after-probability', function() {
        var chartElement = addChartTemplate();
        $.getCachedJSON('./charts/output/merged-after-probability.json').then(function(data) {
            var toPoint = function(details) {
                return {
                    x: details.duration,
                    y: details.mergeProbability
                }
            };
            var approximatedData = data.approximatedPoints.map(toPoint);
            var chartData = data.points.map(toPoint);
            var maxDuration = maxX(approximatedData);
            var currentDuration = Math.min(maxDuration, 60);
            var chart = createChart(chartElement.querySelector('.chart'), {
                type: 'line',
                data: {
                    datasets: [{
                        type: 'bubble',
                        label: 'Probability if it will be merged',
                        data: chartData,
                        backgroundColor: colors.black,
                        hoverBorderWidth: 1,
                        hoverRadius: 1
                    }, {
                        label: 'Approximated probability if it will be merged',
                        data: approximatedData,
                        backgroundColor: colors.merges,
                        pointRadius: 0
                    }, {
                        label: '',
                        data: [
                            {x: 0, y: 1},
                            {x: maxDuration * 2, y: 1}
                        ],
                        backgroundColor: colors.rejects,
                        pointRadius: 0
                    }],
                    verticalLines: [data.fiftyPercentX],
                    horizontalLines: [0.5]
                },
                options: {
                    elements: {point: {radius: 1}},
                    tooltips: {enabled: false},
                    scales: {
                        xAxes: [{
                            type: 'linear',
                            position: 'bottom',
                            ticks: {
                                beginAtZero: true,
                                max: currentDuration,
                                minRotation: 30,
                                maxRotation: 30
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'Days'
                            }
                        }],
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                min: 0,
                                max: 1,
                                callback: toPercentLabel
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'Probability'
                            }
                        }]
                    }
                }
            });
            createSlider(chartElement.querySelector('.x-slider-bottom'), {
                range: true,
                scale: 'logarithmic',
                min: 0,
                max: maxDuration,
                value: [0, currentDuration]
            }).on("slide", updateXAxes(chart));
        });
    });
</script>
