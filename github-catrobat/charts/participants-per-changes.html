<div class="page"></div>
<script>
    menu.registerMenu('Participants Per Pull Request', '#link-chart-participants-per-pull-request', function() {
        var chartElement = addChartTemplate();
        $.getCachedJSON('./charts/output/participants-per-changes.json').then(function(data) {
            var merges = [];
            var rejects = [];
            data.forEach(function(details) {
                var p = {
                    x: details.changes,
                    y: details.participants,
                    label: '#' + details.number
                };
                if (details.merged) {
                    merges.push(p);
                } else {
                    rejects.push(p);
                }
            });

            var maxChanges = maxX(merges.concat(rejects));
            var currentChanges = 10000;
            var chart = createChart(chartElement.querySelector('.chart'), {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Merged',
                        data: merges,
                        backgroundColor: colors.merges
                    }, {
                        label: 'Rejected',
                        data: rejects,
                        backgroundColor: colors.rejects
                    }]
                },
                options: {
                    tooltips: {
                        callbacks: {
                            label: function(tooltipItem, data) {
                                return data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index].label;
                            }
                        }
                    },
                    scales: {
                        xAxes: [{
                            ticks: {
                                beginAtZero: true,
                                max: currentChanges,
                                minRotation: 45,
                                maxRotation: 45
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'Changes'
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Participants'
                            }
                        }]
                    }
                }
            });
            createSlider(chartElement.querySelector('.x-slider-bottom'), {
                range: true,
                min: 0,
                scale: 'logarithmic',
                max: maxChanges,
                value: [0, currentChanges]
            }).on("slide", updateXAxes(chart));
        });
    });
</script>
